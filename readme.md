
#### 数据准备
VideoAttentionTarget: [link](https://www.dropbox.com/s/8ep3y1hd74wdjy5/videoattentiontarget.zip?dl=0) 下载数据集需要翻墙
#### Training on VideoAttentionTarget
### 路径配置
```
videoattentiontarget_data = "D:\\imgData\\videoCo\\images"  #图片路径
videoattentiontarget_train_label = "D:\\imgData\\videoCo\\annotations\\train" #训练标注数据
videoattentiontarget_val_label = "D:\\imgData\\videoCo\\annotations\\test" #测试标注数据
maxlabeledbboxs=8+2  #模型最多预测多少个人物，8+2：: 训练数据集中最多的人物数量 + 最多预测比训练集多2个
```
#### 数据预处理
```
python  data_opt/pre_process_data.py  #将标注数据进行预处理
# 预处理过程中已经把相邻的5张图片做为相似的图片，在训练过程中会从这5张图中随机选择一张
```

### 训练
```
-- heat_dim  [6,6,40]  # [w0,h0,gaussion] 像素和值域
-- backbone  resnet50  # choice in [resnet50,resnet101]
-- lr_backbone  # backbone 的学习率
-- lr  # 学习率
-- output_dir # 模型保存位置
-- batch_size
-- epochs
开始训练
python train_on_videoattarget.py

```

### 文件说明
```
- models
    matcher.py # Hungarian 算法 ，匹配预测与标注数据，防止过度训练
    detr.py  # DETR模型
        SetCriterion  计算损失
    resnet.py #backbone net,  Backbone 类里 pretrained 配置是否需要预训练的resnet模型，（为True时可能需要代理）
- data_opt
    heat_map.py # 根据标注的注意坐标产生，热视图
    pre_process_data.py #预处理数据
    load_data.py # 加载数据类
```
### 预测
```
-- checkpoint_path # 模型位置
-- prediction_data # 图片路径
python predict.py
>>
{'box': [441, 284, 619, 324], 'watchinside': 0, 'heatmap': [[0.516630232334137, 0.5028473138809204, 0.49008187651634216, 0.4968016445636749, 0.4995037615299225, 0.5072073936462402], [0.5067189335823059, 0.514309823513031, 0.5191013216972351, 0.5071389079093933, 0.5082470178604126, 0.5101688504219055], [0.4854298233985901, 0.4914950728416443, 0.49061861634254456, 0.4910268187522888, 0.49165016412734985, 0.5072758793830872], [0.5116753578186035, 0.4832839071750641, 0.49571487307548523, 0.501747727394104, 0.5183943510055542, 0.5063550472259521], [0.5082405209541321, 0.494773805141449, 0.4830300509929657, 0.5047907829284668, 0.4963941276073456, 0.5160015821456909], [0.5049919486045837, 0.4895952641963959, 0.5165682435035706, 0.4746881425380707, 0.5046082735061646, 0.5051217675209045]]}
{'box': [442, 272, 614, 328], 'watchinside': 0, 'heatmap': [[0.5162556767463684, 0.5030785799026489, 0.4899132251739502, 0.4963989555835724, 0.5002909898757935, 0.5088541507720947], [0.5068615674972534, 0.5127185583114624, 0.5192148685455322, 0.5054435729980469, 0.506705641746521, 0.509259045124054], [0.485750287771225, 0.49348485469818115, 0.4897014796733856, 0.49371203780174255, 0.4913497567176819, 0.510168194770813], [0.5119375586509705, 0.48235806822776794, 0.49671873450279236, 0.502349853515625, 0.5181502103805542, 0.5064156651496887], [0.5084061622619629, 0.4929143786430359, 0.4845062792301178, 0.5038129687309265, 0.4969562888145447, 0.513838529586792], [0.5058431625366211, 0.4899173676967621, 0.5149210095405579, 0.47668513655662537, 0.5028417706489563, 0.5066581964492798]]}
#数据格式：
{"box":[x_min,y_min,x_max,y_max],
 "watchinside":1,# 1 为视线在内
 "heatmap":w_dim*h_dim
 }
```
